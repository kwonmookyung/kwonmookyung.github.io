<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>나의 MOTI 분석 결과</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #f0f2f5;
      text-align: center;
    }
    .container {
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 90%;
    }
    h1 {
      color: #333;
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    p {
      color: #666;
      font-size: 1.2rem;
    }
    .loading {
      color: #888;
      font-style: italic;
    }
    .moti-type {
      font-size: 3rem;
      font-weight: bold;
      color: #007bff;
      margin-top: 1rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>나의 MOTI 분석 결과</h1>
    <p id="loading" class="loading">결과를 불러오는 중입니다...</p>
    <div id="result-content" style="display: none;">
      <p>사장님의 MOTI 유형은</p>
      <div id="moti-type" class="moti-type"></div>
      <p>입니다!</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase 설정 정보
    const firebaseConfig = {
      apiKey: "AIzaSyDhL9qWkfXRskWCwYh7E1E901luw1MvIK4",
      authDomain: "nbso-b7f41.firebaseapp.com",
      projectId: "nbso-b7f41",
      storageBucket: "nbso-b7f41.firebasestorage.app",
      messagingSenderId: "94203359555",
      appId: "1:94203359555:web:07f9ee21d1291670363ff6",
      measurementId: "G-YCWF8ENKC4"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // URL에서 UUID 파라미터 가져오기
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const uuid = getQueryParam('uuid');
      const loadingElement = document.getElementById('loading');
      const resultContent = document.getElementById('result-content');
      const motiTypeElement = document.getElementById('moti-type');

      if (uuid) {
        try {
          const docRef = doc(db, "survey_results", uuid);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            const finalType = data.finalType;

            // 로딩 메시지 숨기기
            loadingElement.style.display = 'none';

            // 결과 내용 표시
            motiTypeElement.textContent = finalType;
            resultContent.style.display = 'block';

            console.log("✅ 설문 결과 불러오기 성공:", data);
          } else {
            loadingElement.textContent = '❌ 유효하지 않은 결과 링크입니다.';
            console.error("❌ 설문 결과를 찾을 수 없습니다.");
          }
        } catch (e) {
          loadingElement.textContent = '❌ 결과를 불러오는 중 오류가 발생했습니다.';
          console.error("❌ Firestore 데이터 불러오기 오류:", e);
        }
      } else {
        loadingElement.textContent = '❌ 결과 링크가 올바르지 않습니다.';
        console.error("❌ URL에 UUID가 없습니다.");
      }
    });
  </script>
</body>

</html>
